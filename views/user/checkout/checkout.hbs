    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Shop
                    <span></span> Checkout
                </div>
            </div>
        </div>
        <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 mb-sm-15">
                        <div class="toggle_info">
            <select id="selectedAddress" class="form-select form-select-lg mb-3 p-3"
              aria-label=".form-select-lg example">
              {{!-- <option selected>Select an address</option> --}}
              {{#each addressData}}
              <option value="{{this._id}}">{{this.adressLine1}}</option>
              {{/each}}
            </select>
                        </div>
                        

                    </div>
                    <div class="col-lg-6">
                        <div class="toggle_info">
                           <button type="button" class="btn btn-fill-out btn-block mt-30" data-bs-toggle="collapse" data-bs-target="#coupon" aria-expanded="false" aria-controls="coupon"> <i class="fi-rs-label mr-10"></i> Add new Address </button>
                        </div>
                        <div class="panel-collapse collapse coupon_form " id="coupon">
                            <div class="panel-body">
                                                    <div class="mb-25">
                            <h4>Address Form</h4>
                        </div>
                                <form action="/add_new_adress" method="post" >
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="row gx-3">
                                                                    <div class="col-12 mb-3">
                        <label class="form-label">Name</label>
                        <input class="form-control" type="text" placeholder="Enter your name"  name="name"  id="name" required>
                    </div>
                                        <div class="col-lg-12 mb-3">
                        <label class="form-label">Phone</label>
                        <input class="form-control" type="tel" placeholder="Enter your phone number"  name="mobile"  id="mobile" required>
                    </div>
                    <div class="col-lg-12 mb-3">
                        <label class="form-label">Address line 1</label>
                        <input class="form-control" type="text" placeholder="Enter your address"  name="address1" id="address1" required>
                    </div>
                    <div class="col-lg-12 mb-3">
                        <label class="form-label">Address line 2</label>
                        <input class="form-control" type="text" placeholder="Enter your address" name="address2" id="address2" required>
                    </div>
                                        <div class="col-lg-12 mb-3">
                        <label class="form-label">City</label>
                        <input class="form-control" type="text" placeholder="Enter your City" name="city" id="city">
                    </div>
                                        <div class="col-lg-12 mb-3">
                        <label class="form-label">State</label>
                        <input class="form-control" type="text" placeholder="Enter your State"  name="state" id="state">
                    </div>
                                        <div class="col-lg-12 mb-3">
                        <label class="form-label">Pincode</label>
                        <input class="form-control" type="tel" placeholder="Enter your Pincode"  name="pin" id="pin">
                    </div>
                                                
                                            </div> 
                                        </div> 




                                    </div> 
                                    <br>
                                    <button class="btn btn-primary" type="submit" >Save Address</button>
                                    <button type="button" class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#coupon">Close</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="divider mt-50 mb-50"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="order_review">
                            <div class="mb-20">
                                <h4>Your Orders</h4>
                            </div>
                            <div class="table-responsive order_table text-center">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th colspan="2">Product</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                      {{#each cart}}
                                        <tr>
                                            <td class="image product-thumbnail"><img src="/images/products/{{this.product.imageUrl.[0]}}" alt="#"></td>
                                            <td>
                                                <h5><a href="shop-product-full.html">{{this.product.name}}</a></h5> <span class="product-qty">x {{this.quantity }}</span>
                                            </td>
                                            <td>{{this.product.price }}</td>
                                        </tr>
                                         {{/each}}
                                        <tr>
                                            <th>SubTotal</th>
                                            <td class="product-subtotal" colspan="2">{{subTotal}}</td>
                                        </tr>
                                        <tr>
                                            <th>Shipping</th>
                                            <td colspan="2"><em>Free Shipping</em></td>
                                        </tr>
                                        <tr>
                                            <th>Total</th>
                                            <td colspan="2" class="product-subtotal"><span class="font-xl text-brand fw-900">{{subTotal}}</span></td>
                                            <input type="hidden" name="subTotal" value="{{subTotal}}" id="subTotal">
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                            
                            <div class="payment_method">
                                <div class="mb-25">
                                    <h5>Payment</h5>
                                </div>
                                <div class="payment_option">
                                    <div class="custome-radio">
                                        <input class="form-check-input" required="" type="radio" name="payment_option" id="cash-on-delivery" checked="" value="cash-on-delivery">
                                        <label class="form-check-label" for="cash-on-delivery" data-bs-toggle="collapse" data-target="#bankTranfer" aria-controls="bankTranfer">Cash On Delivery</label>
                                    </div>
                                    <div class="custome-radio">
                                        <input class="form-check-input" required="" type="radio" name="payment_option" value="razorpay" id="razorpay" checked="">
                                        <label class="form-check-label" for="razorpay" data-bs-toggle="collapse" data-target="#checkPayment" aria-controls="checkPayment"> Razor Pay</label>
                                    </div>
                                    <div class="custome-radio">
                                        <input class="form-check-input" required="" type="radio" name="payment_option" value="wallet" id="wallet" checked="">
                                        <label class="form-check-label" for="exampleRadios5" data-bs-toggle="collapse" data-target="#paypal" aria-controls="paypal"> Wallet</label>
                                        <div class="form-group collapse in" id="paypal">
                                            <p class="text-muted mt-5">Pay via PayPal; you can pay with your credit card if you don't have a PayPal account.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <span id="order_button">
                            <button onclick="placeOrder()" class="btn btn-fill-out btn-block mt-30">Place Order</button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>

  let couponData
  let couponEl
  let newTotal
  let subTotal
  let updateWallet



  /*
   const cashOnDelivery = document.getElementById('cash-on-delivery');
    const razorpay = document.getElementById('razorpay');
  
    cashOnDelivery.addEventListener('change', handleCheckboxChange);
    razorpay.addEventListener('change', handleCheckboxChange); */

  const paymentOption = document.querySelectorAll('input[name="payment_option"]');

  let paymentMethod = null;

  paymentOption.forEach((checkbox) => {
    checkbox.addEventListener('change', () => {
      if (checkbox.checked) {
        paymentMethod = checkbox.value
        console.log("User selected " + checkbox.value);
        console.log(paymentMethod, 'payment method..........')
      } else {
        console.log("User unchecked " + checkbox.value);
      }
    });
  });



  /* function handleCheckboxChange() {
    cashOnDelivery.checked ? paymentMethod = 'cash-on-delivery' : paymentMethod = 'razorpay'
      console.log(paymentMethod)
  } */



  /* const placeOrder = () => {
     paymentMethod == 'cash-on-delivery' ? Cod() : online()
   }*/

  const placeOrder = () => {
    if (paymentMethod === 'cash-on-delivery') {
      Cod()
    } else if (paymentMethod === 'razorpay') {
      online()
    } else if (paymentMethod === 'wallet') {
      useWallet()
    } else {
      console.log('Invalid payment method.')
    }
  }


  const useWallet = () => {
    const wallet = document.getElementsByName('wallet')[0].value
    const subTotal = Number(document.getElementsByName('subTotal')[0].value)
    console.log(wallet, 'walletttttttttttt', subTotal)

    if (wallet > subTotal) {
      updateWallet = wallet - subTotal

      console.log(updateWallet, 'my name is update wallet...........')
      Cod()
    } else {
      alertify.set('notifier', 'position', 'bottom-center');
      alertify.success('you dont have sufficient balance in ur wallet choose another payment method')
    }
  }



  const Cod = async () => {
    const selectAddress = document.querySelector('#selectedAddress').value
    const subTotal = Number(document.getElementsByName('subTotal')[0].value)

    const datas = await fetch('/place_order', {
      method: 'POST',
      headers: {
        'Content-Type': "application/json",
      },

      body: JSON.stringify({

        selectedAddress: selectAddress,
        selectedPayment: paymentMethod,
        amount: subTotal,
        couponData: couponData,
        couponName: couponEl,
        updateWallet: updateWallet
      })
    })

    const placeOrderData = await datas.json()

    if (placeOrderData) {
      console.log(' hiiii am from place oreder data')

      //const wallet = document.getElementById('update_wallet').innerText = updateWallet
      window.location.href = '/order_sucess'
    }
  }

  const online = () => {
    subTotal = Number(document.getElementsByName('subTotal')[0].value)


    var options = {
      "key": "rzp_test_6u4aUWyjD4kZvI", // Enter the Key ID generated from the Dashboard
      "amount": subTotal * 100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",

      /*"name": "Acme Corp", //your business name
      "description": "Test Transaction",
      "image": "https://example.com/your_logo",*/

      "order_id": undefined, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response) {
        Cod()
      },

    };
    var rzp1 = new Razorpay(options);
    rzp1.open();

  }




  let couponStatus

  const validateCoupon = async () => {
    couponEl = document.getElementById('copon').value
    subTotal = Number(document.getElementsByName('subTotal')[0].value)

    console.log(couponEl)

    console.log('heloooo from validate coupon...............')
    const response = await fetch('/validate_coupon', {
      method: 'POST',
      headers: {
        'Content-Type': "application/json",
      },

      body: JSON.stringify({
        couponVal: couponEl,
        subTotal: subTotal

      })
    })


    console.log('hiiiii from coupon status........;;;;;;')
    couponData = await response.json()
    console.log(couponData)

    const setCouponStatus = (msg, id) => {

      id.innerHTML = `<p>${msg}</p>`

      setTimeout(() => {
        id.style.opacity = 0
        id.style.innerText = ''
      }, 5000)
    }


    const coponMsg = document.getElementById('couponMsg')
    const sCoponMsg = document.getElementById('sCoponMsg')

    if (couponData === 'invalid') {
      setCouponStatus('Invalid coupon', coponMsg)
    }
    else if (couponData === 'alredy used') {
      setCouponStatus('Coupon alredy used', coponMsg)
    }else if (couponData === 'expired'){
      setCouponStatus('Coupon has been Expired.!', coponMsg)
    }

    if (couponData.succes === 'succes') {
      console.log('am from coupon sucesssss')
      setCouponStatus('Coupon applied successfuly', sCoponMsg)

      subTotal = Number(document.getElementById('new_sub_total').innerHTML = `<strong >$${couponData.newTotal}</strong>`)
      document.getElementById('copoun_code').innerHTML = `<small>${couponEl}</small>`
      document.getElementById('discount_amt').innerHTML = `<span class="text-success">-$${couponData.discountAmt}</span>`

    }
  }




</script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>








  /*rzp1.on('payment.failed', function (response){
          alert(response.error.code);
          alert(response.error.description);
          alert(response.error.source);
          alert(response.error.step);
          alert(response.error.reason);
          alert(response.error.metadata.order_id);
          alert(response.error.metadata.payment_id);
  });*/

</script>